<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Integrative Health (iHEALTH) Lab</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #74C69D;
      --secondary: #157F97;
      --accent: #C04065;
      --background: #FBF9F6;
      --text: #333333;
      --light-text: #FFFFFF;
    }
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Lora', serif;
      background: var(--background);
      color: var(--text);
    }
    header {
      display: flex;
      align-items: center;
      background: var(--secondary);
      padding: 0 32px;
      height: 160px;
    }
    .logo {
      max-height: 160px;
      margin-right: 12px;
    }
    header h1 {
      font-size: 4rem;
      font-family: 'Montserrat', sans-serif;
      color: var(--light-text);
      flex: 1;
    }
    nav {
      display: flex;
      background: var(--secondary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    nav button {
      flex: 1;
      background: none;
      border: none;
      padding: 10px;
      color: var(--light-text);
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s;
    }
    nav button:hover,
    nav button.active {
      background: var(--accent);
    }
    main {
      max-width: 1100px;
      margin: 10px auto;
      padding: 0 8px;
    }
    .tab-content {
      display: none;
      background: var(--light-text);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      animation: fadeIn 0.4s ease-out;
    }
    .tab-content.active {
      display: block;
    }
    h2 {
      font-size: 2rem;
      margin-bottom: 8px;
      font-weight: 700;
    }
    .decorative-bar {
      width: 60px;
      height: 3px;
      background: var(--accent);
      margin-bottom: 12px;
      border-radius: 2px;
    }
    p, li, strong {
      line-height: 1.4;
    }
    ul {
      padding-left: 2em;
      margin-bottom: 1em;
    }
    li {
      margin-bottom: 0.4em;
      text-indent: -0.4em;
      padding-left: 0.4em;
    }
    .section-img {
      width: 100%;
      max-height: 150px;
      object-fit: cover;
      border-radius: 4px;
      margin: 10px 0;
      border: 2px solid var(--accent);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    footer {
      text-align: center;
      padding: 8px 0;
      font-size: 0.85rem;
      color: var(--text);
    }
  </style>
</head>

<body>
  <header>
    <img class="logo" src="assets/logo-colored.png" alt="iHealth Lab Logo">
    <h1>iHEALTH Lab</h1>
  </header>

  <nav>
    <button class="tab-link active" data-tab="about">About Us</button>
    <button class="tab-link" data-tab="lab-focus">Lab Focus</button>
    <button class="tab-link" data-tab="news">News</button>
    <button class="tab-link" data-tab="projects">Projects</button>
    <button class="tab-link" data-tab="publications">Publications</button>
    <button class="tab-link" data-tab="contact">Contact</button>
  </nav>

  <main>
    <section id="about" class="tab-content active">
      <h2>About Us</h2>
      <div class="decorative-bar"></div>
      <p>Welcome to iHEALTH Lab! We are a young, dynamic research team exploring integrative healthcare across acupuncture, herbal medicine, Tai Chi, and more. Led by <strong>Dr. Mingxiao Yang, MD (CMD), PhD</strong>, our mission is to bring evidence-based integrative therapies to all.</p>
      <p><strong>Join us:</strong> Undergraduate/graduate students, postdocs, and collaboratorsâ€”reach out at <a href="mailto:mingxiao.yang@ntu.edu.sg">mingxiao.yang@ntu.edu.sg</a>.</p>
      <img class="section-img" src="assets/bamboo.jpg" alt="Bamboo Forest">
    </section>

    <section id="lab-focus" class="tab-content">
      <h2>Lab Focus</h2>
      <div class="decorative-bar"></div>
      <ul>
        <li><strong>Integrative Therapies:</strong> Acupuncture, herbal medicine, Tai Chi & exercise for cancer side-effects, metabolic syndrome & cardiovascular diseases.</li>
        <li><strong>Mechanistic Research:</strong> Neurobiology, omics, neuroimaging & quantitative sensory testing to study cognition & memory.</li>
        <li><strong>Healthcare Innovation:</strong> AI, digital platforms & implementation science to improve therapy access.</li>
      </ul>
      <img class="section-img" src="assets/amazon.jpg" alt="Amazon Forest">
    </section>

    <section id="news" class="tab-content">
      <h2>News</h2>
      <div class="decorative-bar"></div>
      <p>Loading newsâ€¦</p>
    </section>

    <section id="projects" class="tab-content">
      <h2>Projects</h2>
      <div class="decorative-bar"></div>
      <p><strong>Ongoing Projects:</strong></p>
      <ul>
        <li>Tai Chi for Chemotherapy-Induced Peripheral Neuropathy: waitlist-controlled trial (Osher Pilot).</li>
        <li>Massage Therapy for Cancer Symptom Care: systematic review & evidence map.</li>
        <li>NIH R21: acupuncture vs CBT on dopamine metabolism in insomnia.</li>
      </ul>
      <img class="section-img" src="assets/egypt.jpg" alt="Egypt Landscape">
    </section>

    <section id="publications" class="tab-content">
      <h2>Publications</h2>
      <div class="decorative-bar"></div>
      <p>See our full peer-reviewed list:</p>
      <ul>
        <li><a href="https://www.ncbi.nlm.nih.gov/myncbi/mingxiao.yang.1/bibliography/public/" target="_blank">NCBI MyBibliography</a></li>
        <li><a href="https://orcid.org/0000-0002-6514-3366" target="_blank">ORCID</a></li>
        <li><a href="https://dr.ntu.edu.sg/cris/rp/rp02629?" target="_blank">NTU Academic Profile</a></li>
        <li><a href="https://scholar.google.com/citations?user=aUw2u1AAAAAJ&hl=en" target="_blank">Google Scholar</a></li>
      </ul>
      <img class="section-img" src="assets/thailand-lake.jpg" alt="Calm Lake, Thailand">
    </section>

    <section id="contact" class="tab-content">
      <h2>Contact</h2>
      <div class="decorative-bar"></div>
      <p><strong>Dr. Mingxiao Yang, MD (CMD), PhD</strong><br>
         Assistant Professor, School of Biological Sciences & NTU Chinese Medicine Clinic<br>
         Nanyang Technological University, Singapore</p>
      <p><strong>Email:</strong> <a href="mailto:mingxiao.yang@ntu.edu.sg">mingxiao.yang@ntu.edu.sg</a><br>
         <strong>Address:</strong> 60 Nanyang Drive, Singapore 637551</p>
      <img class="section-img" src="assets/nyc.jpg" alt="New York City Skyline">
    </section>
  </main>

  <footer>
    &copy; 2025 iHEALTH Lab. All rights reserved.
  </footer>

  <!-- Tab switching -->
  <script>
    const tabs = document.querySelectorAll('.tab-link');
    const contents = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.onclick = () => {
      tabs.forEach(t => t.classList.remove('active'));
      contents.forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  </script>

  <!-- Firebase SDK + Config -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB25bg3MSku1WlLfxsAFq9w9IycaKg1Vlo",
      authDomain: "ihealth-lab.firebaseapp.com",
      projectId: "ihealth-lab",
      storageBucket: "ihealth-lab.firebasestorage.app",
      messagingSenderId: "77438226476",
      appId: "1:77438226476:web:2acbbf70ff480a3d4e4189"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <!-- Enhanced dynamic news loader -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const newsSection = document.querySelector('#news');
      const newsContent = newsSection.querySelector('p');
      const controlBar = document.createElement('div');
      controlBar.style.display = 'flex';
      controlBar.style.flexWrap = 'wrap';
      controlBar.style.gap = '10px';
      controlBar.style.marginBottom = '1em';

      const filterOptions = document.createElement('select');
      filterOptions.innerHTML = `
        <option value="latest">Show Latest 3</option>
        <option value="all">Show All</option>
      `;
      filterOptions.style.padding = '6px';
      filterOptions.style.borderRadius = '6px';
      filterOptions.style.border = '1px solid #ccc';

      const yearSelect = document.createElement('select');
      yearSelect.innerHTML = `<option value="all">All Years</option>`;
      yearSelect.style.padding = '6px';
      yearSelect.style.borderRadius = '6px';
      yearSelect.style.border = '1px solid #ccc';

      const tagInput = document.createElement('input');
      tagInput.type = 'text';
      tagInput.placeholder = 'Filter by keyword (e.g. grant)';
      tagInput.style.padding = '6px';
      tagInput.style.borderRadius = '6px';
      tagInput.style.border = '1px solid #ccc';
      tagInput.style.flex = '1';

      controlBar.append(filterOptions, yearSelect, tagInput);
      newsContent.parentNode.insertBefore(controlBar, newsContent);

      function getTagLabel(text) {
        const t = text.toLowerCase();
        if (t.includes('grant')) return 'ðŸ’° Grant';
        if (t.includes('review')) return 'ðŸ§ª Research';
        if (t.includes('news') || t.includes('announcement')) return 'ðŸ“¢ News';
        return 'ðŸ“Œ Update';
      }

      function formatContent(txt) {
        return txt
          .replace(/\n/g, '<br>')
          .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>')
          .replace(/([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})/g,
                   '<a href="mailto:$1">$1</a>');
      }

      async function loadNews(filter='latest', keyword='', yearFilter='all') {
        const snapshot = await db.collection('news').orderBy('timestamp','desc').get();
        newsContent.innerHTML = '';
        let items = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));

        // populate years
        const yrs = [...new Set(items.map(n => new Date(n.date).getFullYear()))].sort((a,b)=>b-a);
        yearSelect.innerHTML = '<option value="all">All Years</option>';
        yrs.forEach(y => {
          const o = document.createElement('option');
          o.value = y; o.textContent = y;
          yearSelect.appendChild(o);
        });

        if (keyword.trim()) {
          const kw = keyword.toLowerCase();
          items = items.filter(n =>
            n.title.toLowerCase().includes(kw) ||
            n.content.toLowerCase().includes(kw)
          );
        }
        if (yearFilter!=="all") {
          items = items.filter(n =>
            new Date(n.date).getFullYear().toString()===yearFilter
          );
        }
        const display = filter==='latest'? items.slice(0,3) : items;
        if (!display.length) {
          newsContent.innerHTML = '<p>No news found.</p>';
          return;
        }
        display.forEach(n => {
          const card = document.createElement('div');
          card.style.marginBottom='1em';
          card.style.padding='15px';
          card.style.border='1px solid #ccc';
          card.style.borderRadius='10px';
          card.style.background='#fff';
          card.style.boxShadow='0 4px 12px rgba(0,0,0,0.05)';
          card.style.animation='fadeInNews 0.5s ease forwards';

          const tagDiv = document.createElement('div');
          tagDiv.textContent = getTagLabel(n.title+n.content);
          tagDiv.style.color='#157F97';
          tagDiv.style.marginBottom='0.4em';

          const titleLink = document.createElement('a');
          titleLink.href='javascript:void(0)';
          titleLink.textContent=`${n.date}: ${n.title}`;
          titleLink.style.display='block';
          titleLink.style.fontWeight='bold';
          titleLink.style.marginBottom='0.5em';
          titleLink.style.color='#157F97';

          const fullP = document.createElement('p');
          fullP.innerHTML = formatContent(n.content);
          fullP.style.display='none';
          titleLink.onclick = () => {
            fullP.style.display = fullP.style.display==='none'?'block':'none';
          };

          card.append(tagDiv, titleLink, fullP);
          newsContent.appendChild(card);
        });
      }

      filterOptions.addEventListener('change',   ()=>loadNews(filterOptions.value, tagInput.value, yearSelect.value));
      yearSelect.addEventListener('change',      ()=>loadNews(filterOptions.value, tagInput.value, yearSelect.value));
      tagInput.addEventListener('input',         ()=>loadNews(filterOptions.value, tagInput.value, yearSelect.value));

      loadNews();
    });
  </script>

  <style>
    @keyframes fadeInNews {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</body>
</html>
